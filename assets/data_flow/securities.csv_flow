{"name":"securities.csv_flow","description":"","pipeline":{"version":"1.0","doc_type":"pipeline","app_data":{"shaperCreated":true,"replace_space_by_dot":true},"primary_pipeline":"pipeline1","pipelines":[{"id":"pipeline1","nodes":[{"id":"source1","data_asset":{"properties":{"file_name":"/data_asset/securities.csv","first_line_header":"true","encoding":"UTF-8","invalid_data_handling":"fail","file_format":"csv"},"ref":"330998a1-a40b-4cdd-b4c9-2abf3b00e0dc","project_ref":"430d45d6-51bc-4b8b-9653-ed21ff394e8f","app_data":{}},"type":"binding","output":{"id":"source1output"}},{"id":"source_999472ac-3a42-4da5-a81b-b08df961d7bf","data_asset":{"ref":"ce7594e7-2117-4085-ac9f-f9a3c0ff7091","project_ref":"430d45d6-51bc-4b8b-9653-ed21ff394e8f","app_data":{}},"type":"binding","output":{"id":"source2output"}},{"id":"0a1a923e-1420-4a30-9521-ad26fb9b1f86","type":"execution_node","op":"com.ibm.wdp.transformer.FreeformCode","app_data":{"uiParams":{"key":"mutate","code":"eval({for (input in c()) { if(!input %in% names(.)) stop(paste(\"The schema has changed. Edit the operation and click Apply.\"), call. = FALSE) else .}})%>%select(everything())","args":{"type":"mutate","conditions":[],"auto":true,"autoConditions":[],"version":1}}},"parameters":{"FREEFORM_CODE":"eval({for (input in c()) { if(!input %in% names(.)) stop(paste(\"The schema has changed. Edit the operation and click Apply.\"), call. = FALSE) else .}})%>%select(everything())"},"inputs":[{"id":"inputPort1","links":[{"node_id_ref":"source1","port_id_ref":"source1output"}]}],"outputs":[{"id":"outputPort1"}]},{"id":"58c60c84-299c-4ddd-a51d-5fb76b354366","type":"execution_node","op":"com.ibm.wdp.transformer.FreeformCode","app_data":{"uiParams":{"key":"removeDuplicates","code":"distinct(`CIK`, .keep_all = T)","args":{"column":"CIK","keepAllFlag":true,"version":1}}},"parameters":{"FREEFORM_CODE":"group_by(`CIK`) %>% filter(1 == row_number(`CIK`))"},"inputs":[{"id":"inputPort1","links":[{"node_id_ref":"0a1a923e-1420-4a30-9521-ad26fb9b1f86","port_id_ref":"outputPort1"}]}],"outputs":[{"id":"outputPort2"}]},{"id":"cb664a10-eda5-41e3-ad87-2380f84abed0","type":"execution_node","op":"com.ibm.wdp.transformer.FreeformCode","app_data":{"uiParams":{"key":"splitColumn","code":"tidyr::separate(`Address of Headquarters`, into = c('City'),sep = stringr::fixed(\",\"), remove = FALSE, extra = 'merge', fill = 'right')","args":{"column":"Address of Headquarters","type":"text","value":",","removeAllColumns":false,"extra":"merge","fill":"right","newColumnNames":"City","version":1}}},"parameters":{"FREEFORM_CODE":"spark_apply(function(df) tidyr::separate(df, `Address of Headquarters`, into = c('City'),sep = stringr::fixed(\",\"), remove = FALSE, extra = 'merge', fill = 'right'), memory=FALSE)"},"inputs":[{"id":"inputPort1","links":[{"node_id_ref":"58c60c84-299c-4ddd-a51d-5fb76b354366","port_id_ref":"outputPort2"}]}],"outputs":[{"id":"outputPort3"}]},{"id":"7b7bf09b-a42e-4310-a86f-3eb03de5288e","type":"execution_node","op":"com.ibm.wdp.transformer.FreeformCode","app_data":{"uiParams":{"key":"freeform-code","code":"arrange(`Ticker symbol`)"}},"parameters":{"FREEFORM_CODE":"arrange(`Ticker symbol`)"},"inputs":[{"id":"inputPort1","links":[{"node_id_ref":"cb664a10-eda5-41e3-ad87-2380f84abed0","port_id_ref":"outputPort3"}]}],"outputs":[{"id":"outputPort4"}]},{"id":"66f43b8f-c08e-4299-9af6-7f142fe1b93f","type":"execution_node","op":"com.ibm.wdp.transformer.FreeformCode","app_data":{"uiParams":{"key":"splitColumn","code":"tidyr::separate(`Address of Headquarters`, into = c('Cityv2','State'),sep = 10, remove = FALSE, extra = 'merge', fill = 'right')","args":{"column":"Address of Headquarters","type":"position","value":"10","removeAllColumns":false,"extra":"merge","fill":"right","newColumnNames":"Cityv2,State","version":1}}},"parameters":{"FREEFORM_CODE":"spark_apply(function(df) tidyr::separate(df, `Address of Headquarters`, into = c('Cityv2','State'),sep = 10, remove = FALSE, extra = 'merge', fill = 'right'), memory=FALSE)"},"inputs":[{"id":"inputPort1","links":[{"node_id_ref":"7b7bf09b-a42e-4310-a86f-3eb03de5288e","port_id_ref":"outputPort4"}]}],"outputs":[{"id":"outputPort5"}]},{"id":"0cb85e1d-ed1d-4976-98fc-7e1cb01e3ebf","type":"execution_node","op":"com.ibm.wdp.transformer.FreeformCode","app_data":{"uiParams":{"key":"conditionalReplace","code":"mutate(`cleanedaddress` = case_when((stringr::str_detect(`Address of Headquarters`,stringr::fixed(\"California\"))) ~ \"CA\", TRUE ~ `Address of Headquarters`))","args":{"column":"Address of Headquarters","columnActualType":"String","conditions":[{"column":"Address of Headquarters","actualType":"String","operator":"contains","value":"California","valueOption":"text","replaceValue":"CA"}],"defaultReplaceValueOption":"column","defaultReplaceValue":"Address of Headquarters","newColumnName":"cleanedaddress"}}},"parameters":{"FREEFORM_CODE":"mutate(`cleanedaddress` = case_when((instr(`Address of Headquarters`, \"California\") > 0) ~ \"CA\", TRUE ~ `Address of Headquarters`))"},"inputs":[{"id":"inputPort1","links":[{"node_id_ref":"66f43b8f-c08e-4299-9af6-7f142fe1b93f","port_id_ref":"outputPort5"}]}],"outputs":[{"id":"outputPort6"}]},{"id":"fffb89aa-9a77-4855-baf9-3378a29fd4de","type":"execution_node","op":"com.ibm.wdp.transformer.FreeformJoin","app_data":{"uiParams":{"key":"join","code":"right_join(<secondary_input>, by = c(\"Ticker symbol\"=\"symbol\") , suffix = c(\"_x\",\"_y\")) %>% select('Ticker symbol','Security','SEC filings','GICS Sector','GICS Sub Industry','Address of Headquarters','Cityv2','State','City','Date first added','CIK','cleanedaddress','date','open','close','low','high','volume')","args":{"type":"right","primaryInput":{"suffix":"_x","joinkeys":["Ticker symbol"]},"secondaryInput":{"sourceName":"prices.csv","sourceId":"source_999472ac-3a42-4da5-a81b-b08df961d7bf","suffix":"_y","joinkeys":["symbol"]},"outputColumns":["Ticker symbol","Security","SEC filings","GICS Sector","GICS Sub Industry","Address of Headquarters","Cityv2","State","City","Date first added","CIK","cleanedaddress","date","open","close","low","high","volume"]}}},"parameters":{"FREEFORM_CODE":"right_join(<secondary_input>, by = c(\"Ticker symbol\"=\"symbol\") , suffix = c(\"_x\",\"_y\")) %>% select('Ticker symbol','Security','SEC filings','GICS Sector','GICS Sub Industry','Address of Headquarters','Cityv2','State','City','Date first added','CIK','cleanedaddress','date','open','close','low','high','volume')","primary":{"id":"inputPort1"},"secondary":{"id":"inputPort2"}},"inputs":[{"id":"inputPort1","links":[{"node_id_ref":"0cb85e1d-ed1d-4976-98fc-7e1cb01e3ebf","port_id_ref":"outputPort6"}]},{"id":"inputPort2","links":[{"node_id_ref":"source_999472ac-3a42-4da5-a81b-b08df961d7bf","port_id_ref":"source2output"}]}],"outputs":[{"id":"outputPort7"}]},{"id":"a3b8bf8f-f031-4cff-8a4f-4b45a57c3c1a","type":"execution_node","op":"com.ibm.wdp.transformer.FreeformCode","app_data":{"uiParams":{"key":"mutate","code":"mutate(`open` = as.double(`open`))","args":{"type":"mutate","conditions":[{"column":"open","type":"as.double","format":"","newColumnName":"","actualType":"String"}],"auto":false,"autoConditions":[],"version":1}}},"parameters":{"FREEFORM_CODE":"mutate(`open` = as.double(`open`))"},"inputs":[{"id":"inputPort1","links":[{"node_id_ref":"fffb89aa-9a77-4855-baf9-3378a29fd4de","port_id_ref":"outputPort7"}]}],"outputs":[{"id":"outputPort8"}]},{"id":"62b893ef-f997-47da-958c-37d2e659f849","type":"execution_node","op":"com.ibm.wdp.transformer.FreeformCode","app_data":{"uiParams":{"key":"mutate","code":"eval({for (input in c('close','low','high','volume')) { if(!input %in% names(.)) stop(paste(\"The schema has changed. Edit the operation and click Apply.\"), call. = FALSE) else .}})%>%mutate(`close` = as.double(`close`),`low` = as.double(`low`),`high` = as.double(`high`),`volume` = as.double(`volume`))","args":{"type":"mutate","conditions":[],"auto":true,"autoConditions":[{"column":"close","type":"as.double","newColumnName":"","format":"","actualType":"character","removeColumn":false},{"column":"low","type":"as.double","newColumnName":"","format":"","actualType":"character","removeColumn":false},{"column":"high","type":"as.double","newColumnName":"","format":"","actualType":"character","removeColumn":false},{"column":"volume","type":"as.double","newColumnName":"","format":"","actualType":"character","removeColumn":false}],"version":1}}},"parameters":{"FREEFORM_CODE":"mutate(`close` = as.double(`close`),`low` = as.double(`low`),`high` = as.double(`high`),`volume` = as.double(`volume`))"},"inputs":[{"id":"inputPort1","links":[{"node_id_ref":"a3b8bf8f-f031-4cff-8a4f-4b45a57c3c1a","port_id_ref":"outputPort8"}]}],"outputs":[{"id":"outputPort9"}]},{"id":"e1f14284-087b-407f-96af-dd700901e8db","type":"execution_node","op":"com.ibm.wdp.transformer.FreeformCode","app_data":{"uiParams":{"key":"mutate","code":"mutate(`date` = lubridate::ymd_hms(`date`))","args":{"type":"mutate","conditions":[{"column":"date","type":"to_timestamp","newColumnName":"","format":"ymd_hms","actualType":"String","removeColumn":false}],"auto":false,"autoConditions":[{"column":"volume","type":"as.integer","newColumnName":"","format":"","actualType":"double","removeColumn":false}],"version":1}}},"parameters":{"FREEFORM_CODE":"mutate(`date` = stringToTimestampFormat(`date`,'ymd_hms'))"},"inputs":[{"id":"inputPort1","links":[{"node_id_ref":"62b893ef-f997-47da-958c-37d2e659f849","port_id_ref":"outputPort9"}]}],"outputs":[{"id":"outputPort10"}]},{"id":"9c2b1173-5394-4670-a685-0eedc29ac5a4","type":"execution_node","op":"com.ibm.wdp.transformer.FreeformCode","app_data":{"uiParams":{"key":"extractDateTime","code":"mutate(`doy` = lubridate::yday(`date`))","args":{"column":"date","type":"yday","actualType":"Timestamp","newColumnName":"doy","version":1}}},"parameters":{"FREEFORM_CODE":"mutate(`doy` = dayofyear(`date`))"},"inputs":[{"id":"inputPort1","links":[{"node_id_ref":"e1f14284-087b-407f-96af-dd700901e8db","port_id_ref":"outputPort10"}]}],"outputs":[{"id":"outputPort11"}]},{"id":"6e98eec7-4c1a-47ca-8618-5c63061a9c17","type":"execution_node","op":"com.ibm.wdp.transformer.FreeformCode","app_data":{"uiParams":{"key":"calculateNewColumn","code":"mutate(`delta` = `open`-`close`)","args":{"column":"open","operator":"-","option":"column","value":"close","newColumnName":"delta","actualType":"Decimal","version":1}}},"parameters":{"FREEFORM_CODE":"mutate(`delta` = `open`-`close`)"},"inputs":[{"id":"inputPort1","links":[{"node_id_ref":"9c2b1173-5394-4670-a685-0eedc29ac5a4","port_id_ref":"outputPort11"}]}],"outputs":[{"id":"outputPort12"}]},{"data_asset":{"properties":{"file_format":"csv","mode":"overwrite","first_line_header":true,"name":"securities.csv_shaped.csv"},"project_ref":"430d45d6-51bc-4b8b-9653-ed21ff394e8f","app_data":{"project_name":"NYSE_Trading_CPD__git","targetType":"dataAsset"}},"id":"target1","type":"binding","input":{"id":"targetInput1","link":{"node_id_ref":"6e98eec7-4c1a-47ca-8618-5c63061a9c17","port_id_ref":"outputPort12"}}}],"runtime":"Spark"}]}}